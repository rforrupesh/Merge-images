<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GPS Camera Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
body { margin: 0; font-family: Arial, sans-serif; background: #000; color: #fff; }
#captureArea { width: 100%; max-width: 480px; margin: auto; }
video { width: 100%; }
.overlay { position: relative; padding: 10px; background: rgba(0,0,0,0.7); font-size: 14px; }
#map { height: 240px; margin-top: 10px; }
button { padding: 12px; background: #4CAF50; border: none; color: white; border-radius: 5px; margin: 8px; width: calc(50% - 16px); font-size: 16px; }
button:hover { background: #45a049; }
.controls { text-align: center; }
</style>
</head>

<body>

<div id="captureArea">
    <div class="overlay">
        üìç Lat: <span id="lat">--</span><br>
        üìç Lon: <span id="lon">--</span><br>
        üéØ Accuracy: <span id="accuracy">--</span><br>
        üïí <span id="time">--</span>
    </div>

    <video id="video" autoplay playsinline></video>
    <div id="map"></div>
</div>

<div class="controls">
    <button onclick="startApp()">Start</button>
    <button onclick="capturePhoto()">Capture Photo</button>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
let map, marker, circle;

function startApp(){
    startCamera();
    startGPS();
    startClock();
}

function startCamera(){
    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
    .then(stream => document.getElementById("video").srcObject = stream)
    .catch(err => alert("Camera access denied."));
}

function startGPS(){
    if(!navigator.geolocation) return alert("Geolocation unsupported");

    navigator.geolocation.watchPosition(pos => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        const acc = pos.coords.accuracy;

        document.getElementById("lat").textContent = lat.toFixed(6);
        document.getElementById("lon").textContent = lon.toFixed(6);
        document.getElementById("accuracy").textContent = acc.toFixed(1) + " m";

        if(!map){
            map = L.map('map').setView([lat, lon], 17);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap'
            }).addTo(map);
        }
        if(marker) map.removeLayer(marker);
        if(circle) map.removeLayer(circle);

        marker = L.marker([lat, lon]).addTo(map);
        circle = L.circle([lat, lon], { radius: acc }).addTo(map);

    }, { enableHighAccuracy: true, maximumAge: 0, timeout: 15000 });
}

function startClock(){
    setInterval(() => {
        document.getElementById("time").textContent = new Date().toLocaleString();
    }, 1000);
}

function capturePhoto(){
    // Capture only camera + overlays (not map)
    const video = document.getElementById("video");
    const canvas = document.createElement("canvas");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext("2d").drawImage(video, 0, 0);

    const link = document.createElement("a");
    link.download = "camera_photo.png";
    link.href = canvas.toDataURL();
    link.click();
}
</script>

</body>
</html>
